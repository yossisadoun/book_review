# OAuth Setup for Mobile App

The mobile app uses a different OAuth redirect URL than the web app to ensure they don't conflict.

## Mobile App Redirect URL

The mobile app uses a deep link scheme: `bookreview://auth/callback`

This is automatically generated from the `scheme` field in `app.json` (currently set to `"bookreview"`).

## Supabase Configuration

You need to add the mobile app's redirect URL to your Supabase project:

1. Go to your Supabase Dashboard
2. Navigate to **Authentication** ‚Üí **URL Configuration**
3. Under **Redirect URLs**, add:
   ```
   bookreview://auth/callback
   ```

**IMPORTANT:** Make sure this is the EXACT URL (including the scheme and path). Supabase is case-sensitive.

## Google OAuth Configuration

If you're still being redirected to the web version, check your Google OAuth settings:

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Navigate to **APIs & Services** ‚Üí **Credentials**
3. Find your OAuth 2.0 Client ID (the one used by Supabase)
4. Under **Authorized redirect URIs**, make sure you have:
   - Your Supabase redirect URL: `https://<your-project-ref>.supabase.co/auth/v1/callback`
   - The mobile deep link might not be needed here (Supabase handles it)

## Web App Redirect URL (Separate)

The web app uses a different redirect URL pattern:
- Development: `http://localhost:3000/auth/callback`
- Production: `https://yourusername.github.io/book_review/auth/callback`

These are separate from the mobile redirect URL, so they won't conflict.

## Testing

1. Make sure the redirect URL is added to Supabase
2. Run the mobile app: `npx expo start`
3. Tap "Sign in with Google"
4. Complete the OAuth flow in the browser
5. You should be redirected back to the app automatically

## Troubleshooting

### If OAuth redirects to the web version:

1. **Check Supabase Redirect URLs:**
   - Go to Supabase Dashboard ‚Üí Authentication ‚Üí URL Configuration
   - Verify `bookreview://auth/callback` is in the list
   - Make sure there are no typos (case-sensitive)

2. **Check the console logs:**
   - When you tap "Sign in with Google", check the terminal/console
   - You should see: `üîê Mobile OAuth Sign-In:` with the redirect URL
   - Verify it shows `bookreview://auth/callback`

3. **Verify app.json scheme:**
   - Check that `"scheme": "bookreview"` in `app.json`
   - This must match the redirect URL scheme

4. **Clear cache and restart:**
   ```bash
   npx expo start --clear
   ```

5. **Check if you're using Expo Go:**
   - Deep linking works differently in Expo Go vs development builds
   - Try creating a development build: `npx expo run:ios` or `npx expo run:android`

### If the redirect URL in logs is wrong:

The redirect URL is generated by `Linking.createURL('/auth/callback')`. If it's showing a web URL instead of `bookreview://`, there might be an issue with the Expo configuration.
